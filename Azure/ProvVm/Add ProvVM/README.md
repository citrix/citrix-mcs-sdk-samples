# Provisioning Virtual Machines
## Overview
Using MCS, you can provision virtual machines based on the configuration outlined in a provisioning scheme by these three steps. 
1. New-AcctADAccount allows you to generate new Active Directory (AD) computer accounts and enroll them in a pre-existing identity pool. Throughout the task's duration, the AD accounts are secured by the AD Identity Service and Identity Pool is locked, preventing their use in other machine creation tasks. 
2. The New-ProvVM function is utilized to asynchronously create virtual machines, utilizing the available Active Directory (AD) accounts from the identity pool within the provisioning scheme.
3. New-BrokerMachine allows the addition of a machine to a catalog, integrating it into the site and commencing the process of enabling user access to desktops and applications. 
New-ProvVm create the virtual machine in the ProvScheme whereas New-BrokerMachine creates a Broker Machine object, which associates the VM within the Broker catalog. 

For more detailed information, you can refer to the following documentation:
1. [New-AcctADAccount](https://developer-docs.citrix.com/en-us/citrix-virtual-apps-desktops-sdk/current-release/ADIdentity/New-AcctADAccount.html)
2. [New-ProvVM](https://developer-docs.citrix.com/en-us/citrix-virtual-apps-desktops-sdk/current-release/MachineCreation/New-ProvVM.html)
3. [New-BrokerMachine](https://developer-docs.citrix.com/en-us/citrix-virtual-apps-desktops-sdk/current-release/Broker/New-BrokerMachine.html)

**Note**
1.The New-AcctADAccount cmdlet includes the StartCount parameter, which defaults to the StartCount parameter of the IdentityPool. Alternatively, you have the option to manually define this value. It is crucial to highlight that if the specified value is lower than the StartCount of the IdentityPool, it might result in additional time being required to search for available accounts within the identity pool on the Cloud version. This is due to the necessity to communicate with Active Directory using Cloud Connector before initiating the creation of machines for those available accounts.

2. Before creating virtual machines within a provisioning scheme, controllers can be added using Add-ProvSchemeControllerAddress. This function facilitates the association of controller hosts or a specified set of brokers with a particular provisioning scheme. The optional information provided is then conveyed to the machines generated by the Machine Creation Services, establishing a connection with a specific broker. The resulting list includes details about the associated provisioning scheme.
[Add-ProvSchemeControllerAddress](https://developer-docs.citrix.com/en-us/citrix-daas-sdk/machinecreation/add-provschemecontrolleraddress)

## Common error cases
1. Failed to create AD accounts if ADUserName/ADPassword/IdentityPoolName provided are not valid. Example error message is "Identity Pool not found."
2. Failed to create virtual machines if ProvisioningSchemeName provided is not valid. Example error message is "The specified ProvisioningScheme could not be located."

## Next steps
1. To retrieve information about a Provisioning virtual machine take the reference of sample scripts in Get ProvVM.
2. To update the details of a Provisioning virtual machine take the reference of sample scripts in Update ProvVM.
3. To remove a Provisioning virtual machine take the reference of sample scripts in Remove ProvVM.